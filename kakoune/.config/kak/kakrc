# kakrc


# ui_options
colorscheme base16-ocean
set-face Default rgb:bcbabe,rgb:101520
set-face PrimarySelection rgb:f050f0,rgb:000000
set-face PrimaryCursor rgb:f0f0f0,rgb:602060
set-face SecondarySelection rgb:50f0f0,rgb:000000
set-face SecondaryCursor rgb:000000,rgb:50f0f0
set-face LineNumbers rgb:4f5b66,rgb:101520
set-face LineNumberCursor rgb:ebcb8b,rgb:303030
set-face BufferPadding rgb:65737e,rgb:101520
set global ui_options ncurses_enable_mouse=false:ncurses_assistant=dilbert:ncurses_set_title=false


# global options
set global autoreload ask
set global indentwidth 4
set global scrolloff 1,5
set global tabstop 4
set global termcmd 'st -c kakoune -e sh -c'


# bindings - user
map global user c ':comment-line<ret>'
map global user q ':bp<ret>'
map global user w ':bn<ret>'
map global user = '<a-i>w:spell-replace<ret>'
map global user <ret> ':lint<ret>'
map global user n ':lint-next<ret>'
map global user b ':lint-prev<ret>'

map global user z ':godlv-break-here'
map global user x ':godlv-clear-breaks'

map global user f '|fmt -w 80<ret>:echo -color LineNumberCursor [sel] | fmt -w 80<ret>'
map global user s '|sort -bn<ret>:echo -color LineNumberCursor [sel] | sort -bn<ret>'

map global user p '!xsel<ret>:echo -color LineNumberCursor [sel] += xsel<ret>'


# hooks - run-of-the-mill
hook global WinCreate .* %{
    addhl number_lines -relative -hlcursor -separator " | "
    addhl show_matching
}
hook global NormalKey [/?*nN]|<a-[/?*nN]> %{ try %{
    addhl dynregex '%reg{/}' 0:Search
}}
hook global NormalKey <esc> %{ try %{
    rmhl dynregex_%reg{<slash>}
}}
hook global InsertChar \t %{
    exec -draft -itersel h@
}
hook global InsertKey <backspace> %{ try %{
    exec -draft hGh<a-k>\A\h+\Z<ret><lt>
}}


# hooks - language-specific
hook global WinSetOption filetype=go %{
    set window formatcmd 'goimports'
    set window indentwidth 0
    set window lintcmd 'golint-kak'
    set window makecmd 'go build'

    lint-enable
    go-enable-autocomplete

    hook buffer BufWritePre .* %{ go-format -use-goimports }
    hook buffer BufWritePost .* lint

    map window user d ':go-doc-info<ret>'
}
hook global WinSetOption filetype=sh %{
    set window formatcmd 'shfmt -i 4'
    set window lintcmd 'shellcheck -fgcc -Cnever'

    lint-enable

    hook buffer BufWritePre .* %{ format }
    hook buffer BufWritePost .* lint
}
hook global WinSetOption filetype=python %{
    set window formatcmd 'autopep8 -'
    set window lintcmd 'flake8 --format="%(path)s:%(row)d:%(col)d: error: %(text)s"'
    lint-enable
}
hook global WinSetOption filetype=makefile %{
    set indentwidth 0
}


# "ide"
def ide %{
    rename-client main
    set global jumpclient main

    new rename-client tools
    set global toolsclient tools

    new rename-client docs
    set global docsclient docs
}


# see: autoload/selection-persist.kak
hook global BufWritePre .* %{ save-selection }
map global normal <c-r> ':restore-selection<ret>'
